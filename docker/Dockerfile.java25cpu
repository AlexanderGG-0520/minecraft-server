# ============================================================
# CPU Variant (Fabric + C2ME + OpenCL via POCL)
# ============================================================

FROM eclipse-temurin:25-jdk AS java25-cpu

ENV DEBIAN_FRONTEND=noninteractive

# ------------------------------------------------------------
# System tools & OpenCL (CPU / POCL)
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y \
    ca-certificates \
    curl \
    jq \
    bash \
    unzip \
    git \
    gettext-base \
    uuid-runtime \
    procps \
    tini \
    ocl-icd-libopencl1 \
    opencl-headers \
    pocl-opencl-icd \
    clinfo \
 && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# Runtime layout
# ------------------------------------------------------------
RUN mkdir -p /opt/mc/{scripts,base,fabric,forge,paper} /data

# ------------------------------------------------------------
# Copy runtime assets
# ------------------------------------------------------------
COPY scripts/ /opt/mc/scripts/
COPY base/    /opt/mc/base/
COPY types/   /opt/mc/

RUN chmod +x /opt/mc/scripts/*.sh /opt/mc/base/*.sh

# ------------------------------------------------------------
# Runtime defaults
# ------------------------------------------------------------
WORKDIR /data
VOLUME ["/data"]

ENV JAVA_VERSION=25
ENV JAVA_TOOL_OPTIONS="-Duser.dir=/data"
ENV ENABLE_OPENCL=true
ENV MC_ACCELERATION=opencl

STOPSIGNAL SIGTERM

# ------------------------------------------------------------
# ENTRYPOINT (PID 1 = tini)
# ------------------------------------------------------------
ENTRYPOINT ["/usr/bin/tini", "--", "bash", "/opt/mc/scripts/entrypoint.sh"]
